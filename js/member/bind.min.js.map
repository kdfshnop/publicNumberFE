{"version":3,"sources":["member/bind.min.js"],"names":["BindController","bindTel","self","telReg","timer","time","openId","$","cookie","state","click","tel","val","test","html","css","attr","setInterval","clearInterval","request","apiUrl","member","phoneAuthCode","type","successCallback","data","console","log","errorCallback","err","tips","code","bindSuccess","agentId","verifiedStatus","location","href","targetUrl","exceptionCallback","env","shareLinkDomain","wechatCode","requestUrl","window","result","wx","config","debug","appId","appid","timestamp","nonceStr","nonce_str","signature","jsApiList","ready","showOptionMenu","onMenuShareTimeline","link","onMenuShareAppMessage","Controller","document"],"mappings":"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","file":"bind.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n 1. 项目名称：有房有客微信CDN框架\n 2. 页面名称：bind.js (手机绑定页)\n 3. 作者：douyadong@lifang.com\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\n class BindController extends Controller {\n    constructor() {\n        super() ;\n        this.bindTel();\n    }\n    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n    获取验证码及绑定手机号\n    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\n    bindTel(){\n        let self=this;\n        let telReg=/^1\\d{10}$/;\n        let timer=null;//定时器;\n        let time=60;\n        let openId=$.cookie(\"openId\");\n        let state=$.cookie(\"state\");\n        $('.verify').click(function(){            \n            let tel=$('.tel').val();\n            if(telReg.test(tel)){\n                $('.verify').html(time+'s');\n                $('.verify').css('color','#999999');\n                $('.verify').attr('disabled',true);//获取验证码按钮禁止点击;\n                timer=setInterval(function(){\n                    time--;\n                    if(time==0){\n                        clearInterval(timer);\n                        time=60;\n                        $('.verify').html('获取验证');\n                        $('.verify').css('color','#fc4c5a');\n                        $('.verify').attr('disabled',false);//获取验证码按钮禁止点击;\n                    }else{\n                        $('.verify').html(time+\"s\");\n                    }\n                },1000);\n                // 发送请求,获取验证码;\n                self.request(self.apiUrl.member.phoneAuthCode,{tel,openId},{\n                    type:\"POST\",\n                    successCallback:function(data){\n                        console.log(data,'验证码');\n                    },\n                    errorCallback:function(err){\n                        console.log(err,'err');\n                    }\n                });\n            }else{\n                $.tips('请输入正确手机号',2);\n            }\n        });\n        $('.btn').click(function(){\n            let tel=$('.tel').val();\n            let code=$('.note input').val();\n            if(!telReg.test(tel)){\n                $.tips('请填写正确手机号',2);\n            }else if(!code){\n                $.tips('请输入验证码',2); \n            }else{\n                $('.btn').attr('disabled',true);\n                // 发送请求;\n                self.request(self.apiUrl.member.bindSuccess,{tel,code,openId,state},{\n                    type:\"post\",\n                    successCallback:function(data){\n                        $.cookie('agentId',data.data.agentId);\n                        $('.btn').attr('disabled',false);\n                        if(data.data.verifiedStatus==4){\n                            location.href=data.data.targetUrl;\n                        }else{\n                            location.href=\"/member/profile/edit\";\n                        } \n                    },\n                    errorCallback:function(err){\n                        $('.btn').attr('disabled',false);\n                    },\n                    exceptionCallback:function(data){\n                        $('.btn').attr('disabled',false);\n                    }\n                });\n            }\n        });\n        let env=$.cookie('env')||'dev';\n        let shareLinkDomain=\"\";\n        let wechatCode=\"\";\n        switch(env){\n            case \"dev\" :\n                shareLinkDomain=\"https://wechattest.yfyk365.com\" ;\n                wechatCode=\"5000001\";\n                break;\n            case \"test\" :\n                shareLinkDomain=\"https://wechattest.yfyk365.com\" ;\n                wechatCode=\"5000001\";\n                break ;\n            case \"sim\" :\n                shareLinkDomain=\"https://wechatsim.yfyk365.com\" ;\n                wechatCode=\"4000001\";\n                break ;\n            case \"prod\" :\n                shareLinkDomain=\"https://wechat.yfyk365.com\" ;\n                wechatCode=\"3000001\";\n                break ;\n        };\n        self.request(shareLinkDomain+\"/base/getJsSdkSign.action?wechatCode=\"+wechatCode,{requestUrl: window.location.href},{\n            successCallback(result){\n                let data = result.data;\n                wx.config({\n                    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\n                    appId: data.appid, // 必填，企业号的唯一标识，此处填写企业号corpid\n                    timestamp: data.timestamp, // 必填，生成签名的时间戳\n                    nonceStr: data.nonce_str, // 必填，生成签名的随机串\n                    signature: data.signature, // 必填，签名，见附录1\n                    jsApiList: ['onMenuShareAppMessage', 'onMenuShareTimeline'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2\n                });\n                wx.ready(function () {\n                    wx.showOptionMenu();\n                    console.log('config成功');\n                    wx.onMenuShareTimeline({\n                        link: shareLinkDomain+\"/base/getAuthCode\"\n                    });\n                    wx.onMenuShareAppMessage({\n                        link: shareLinkDomain+\"/base/getAuthCode\"\n                    });\n                });\n            }\n        })\n    }\n }\n /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n类的初始化\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\n$(document).ready(function(){\n    new BindController ;\n}) ;"]}